{"ast":null,"code":"var _this = this,\n    _jsxFileName = \"/Applications/CrowdMOT/crowdmot-nextjs/components/two-dimensional-video/components/Canvas/Canvas.jsx\";\n\nvar __jsx = React.createElement;\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Stage, Layer, Rect, Group, Text } from 'react-konva';\nimport { useTranslation } from 'react-i18next';\nimport { SHOW } from '../../models/incident';\nimport ResizingAnchor from './ResizingAnchor/ResizingAnchor.jsx';\nimport { getInterpolatedData, INTERPOLATION_TYPE } from '../../utils/interpolationUtils';\nimport './canvas.scss';\n\nvar handleGroupDragMove = function handleGroupDragMove(e, canvasWidth, canvasHeight) {\n  if (e.target.getClassName() !== 'Group') return;\n  var group = e.target;\n  var topLeft = group.get('.topLeft')[0];\n  var rect = group.get('Rect')[0];\n  var absX;\n  var absY; // boundary\n\n  absX = topLeft.getAbsolutePosition().x;\n  absY = topLeft.getAbsolutePosition().y;\n  absX = absX < 0 ? 0 : absX;\n  absY = absY < 0 ? 0 : absY;\n  absX = absX + rect.width() > canvasWidth ? canvasWidth - rect.width() : absX;\n  absY = absY + rect.height() > canvasHeight ? canvasHeight - rect.height() : absY;\n  topLeft.setAbsolutePosition({\n    x: absX,\n    y: absY\n  });\n  group.x(topLeft.getAbsolutePosition().x);\n  group.y(topLeft.getAbsolutePosition().y);\n  topLeft.position({\n    x: 0,\n    y: 0\n  });\n};\n\nvar Canvas = function Canvas(_ref) {\n  var className = _ref.className,\n      dotLength = _ref.dotLength,\n      canvasWidth = _ref.width,\n      canvasHeight = _ref.height,\n      objects = _ref.objects,\n      played = _ref.played,\n      focusing = _ref.focusing,\n      isAdding = _ref.isAdding,\n      entities = _ref.entities,\n      annotations = _ref.annotations,\n      isEmptyCheckEnable = _ref.isEmptyCheckEnable,\n      onStageMouseDown = _ref.onStageMouseDown,\n      onGroupDragEnd = _ref.onGroupDragEnd,\n      onGroupMouseDown = _ref.onGroupMouseDown,\n      onDotDragEnd = _ref.onDotDragEnd,\n      onDotMouseDown = _ref.onDotMouseDown;\n\n  var _useTranslation = useTranslation('twoDimensionalVideo'),\n      t = _useTranslation.t;\n\n  var layerItems = [];\n  annotations.slice().reverse().forEach(function (annotationId) {\n    var _entities$annotations = entities.annotations[annotationId],\n        incidents = _entities$annotations.incidents,\n        color = _entities$annotations.color,\n        id = _entities$annotations.id,\n        name = _entities$annotations.name,\n        label = _entities$annotations.label,\n        isManipulatable = _entities$annotations.isManipulatable;\n\n    for (var i = 0; i < incidents.length; i++) {\n      var x = void 0;\n      var y = void 0;\n      var width = void 0;\n      var height = void 0;\n\n      if (played >= incidents[i].time) {\n        if (i !== incidents.length - 1 && played >= incidents[i + 1].time) {\n          continue;\n        }\n\n        if (incidents[i].status !== SHOW) break; // todo\n\n        if (i === incidents.length - 1) {\n          var _incidents$i = incidents[i];\n          x = _incidents$i.x;\n          y = _incidents$i.y;\n          width = _incidents$i.width;\n          height = _incidents$i.height;\n        } else {\n          var interpoArea = getInterpolatedData({\n            startIncident: incidents[i],\n            endIncident: incidents[i + 1],\n            currentTime: played,\n            type: INTERPOLATION_TYPE.LENGTH\n          });\n          var interpoPos = getInterpolatedData({\n            startIncident: incidents[i],\n            endIncident: incidents[i + 1],\n            currentTime: played,\n            type: INTERPOLATION_TYPE.POSITION\n          });\n          x = interpoPos.x;\n          y = interpoPos.y;\n          width = interpoArea.width;\n          height = interpoArea.height;\n        }\n\n        var fill = focusing === name ? color.replace(/,1\\)/, ',.3)') : '';\n\n        var rect = __jsx(Rect, {\n          x: 0,\n          y: 0,\n          fill: fill,\n          width: width,\n          height: height,\n          stroke: color,\n          strokeWidth: 1,\n          onFocus: function onFocus() {},\n          onMouseOver: function onMouseOver() {\n            if (!isManipulatable || isAdding) return;\n            document.body.style.cursor = 'pointer';\n          },\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 6\n          }\n        });\n\n        var labelText = __jsx(Text, {\n          offsetY: 20,\n          x: 0,\n          y: 0,\n          fontFamily: \"Arial\",\n          text: label,\n          fontSize: 16,\n          lineHeight: 1.2,\n          fill: \"#fff\",\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 114,\n            columnNumber: 6\n          }\n        });\n\n        var resizingAnchorsUI = null;\n        var resizingAnchorsData = [{\n          x: 0,\n          y: 0,\n          key: 'topLeft',\n          name: 'topLeft'\n        }, {\n          x: width,\n          y: 0,\n          key: 'topRight',\n          name: 'topRight'\n        }, {\n          x: width,\n          y: height,\n          key: 'bottomRight',\n          name: 'bottomRight'\n        }, {\n          x: 0,\n          y: height,\n          key: 'bottomLeft',\n          name: 'bottomLeft'\n        }, {\n          x: width / 2,\n          y: 0,\n          key: 'top',\n          name: 'top'\n        }, {\n          x: 0,\n          y: height / 2,\n          key: 'left',\n          name: 'left'\n        }, {\n          x: width,\n          y: height / 2,\n          key: 'right',\n          name: 'right'\n        }, {\n          x: width / 2,\n          y: height,\n          key: 'bottom',\n          name: 'bottom'\n        }];\n\n        if (isManipulatable) {\n          resizingAnchorsUI = resizingAnchorsData.map(function (data) {\n            return __jsx(ResizingAnchor, {\n              dotLength: dotLength,\n              color: color,\n              isManipulatable: isManipulatable,\n              x: data.x,\n              y: data.y,\n              key: data.key,\n              name: data.name,\n              canvasWidth: canvasWidth,\n              canvasHeight: canvasHeight,\n              onDragEnd: onDotDragEnd,\n              onMouseDown: onDotMouseDown,\n              __self: _this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 139,\n                columnNumber: 7\n              }\n            });\n          });\n        }\n\n        layerItems.push(__jsx(Group, {\n          x: x,\n          y: y,\n          key: name,\n          id: id,\n          name: name,\n          draggable: isManipulatable,\n          onMouseDown: function onMouseDown(e) {\n            var group = e.target.findAncestor('Group');\n            if (!isManipulatable) return;\n            group.moveToTop();\n            onGroupMouseDown(e);\n          },\n          onDragEnd: function onDragEnd(e) {\n            if (e.target.getClassName() !== 'Group') return;\n            onGroupDragEnd(e);\n          },\n          onDragMove: function onDragMove(e) {\n            return handleGroupDragMove(e, canvasWidth, canvasHeight);\n          },\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 155,\n            columnNumber: 6\n          }\n        }, labelText, rect, resizingAnchorsUI));\n        break;\n      }\n    }\n  });\n  return __jsx(Stage, {\n    width: canvasWidth,\n    height: canvasHeight,\n    className: \"konva-wrapper\",\n    onMouseDown: function onMouseDown(e) {\n      return onStageMouseDown(e);\n    },\n    onMouseOver: function onMouseOver() {\n      if (isAdding) {\n        document.body.style.cursor = 'crosshair';\n      }\n    },\n    onMouseLeave: function onMouseLeave() {\n      document.body.style.cursor = 'default';\n    },\n    onMouseOut: function onMouseOut() {\n      document.body.style.cursor = 'default';\n    },\n    onBlur: function onBlur() {},\n    onFocus: function onFocus() {},\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 3\n    }\n  }, isAdding && __jsx(Layer, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 5\n    }\n  }, __jsx(Rect, {\n    fill: \"#ffffff\",\n    width: canvasWidth,\n    height: canvasHeight,\n    opacity: 0.3,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 6\n    }\n  }), __jsx(Text, {\n    y: canvasHeight / 2,\n    width: canvasWidth,\n    text: t('canvasAddingHint'),\n    align: \"center\",\n    fontSize: 16,\n    fill: \"#fff\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 6\n    }\n  })), __jsx(Layer, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 4\n    }\n  }, layerItems));\n};\n\nCanvas.propTypes = {\n  className: PropTypes.string,\n  dotLength: PropTypes.number\n};\nCanvas.defaultProps = {\n  className: '',\n  dotLength: 6\n};\nexport default Canvas;","map":{"version":3,"sources":["/Applications/CrowdMOT/crowdmot-nextjs/components/two-dimensional-video/components/Canvas/Canvas.jsx"],"names":["React","PropTypes","Stage","Layer","Rect","Group","Text","useTranslation","SHOW","ResizingAnchor","getInterpolatedData","INTERPOLATION_TYPE","handleGroupDragMove","e","canvasWidth","canvasHeight","target","getClassName","group","topLeft","get","rect","absX","absY","getAbsolutePosition","x","y","width","height","setAbsolutePosition","position","Canvas","className","dotLength","objects","played","focusing","isAdding","entities","annotations","isEmptyCheckEnable","onStageMouseDown","onGroupDragEnd","onGroupMouseDown","onDotDragEnd","onDotMouseDown","t","layerItems","slice","reverse","forEach","annotationId","incidents","color","id","name","label","isManipulatable","i","length","time","status","interpoArea","startIncident","endIncident","currentTime","type","LENGTH","interpoPos","POSITION","fill","replace","document","body","style","cursor","labelText","resizingAnchorsUI","resizingAnchorsData","key","map","data","push","findAncestor","moveToTop","propTypes","string","number","defaultProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n\tStage, Layer, Rect, Group, Text,\n} from 'react-konva';\nimport { useTranslation } from 'react-i18next';\nimport { SHOW } from '../../models/incident';\nimport ResizingAnchor from './ResizingAnchor/ResizingAnchor.jsx';\nimport { getInterpolatedData, INTERPOLATION_TYPE } from '../../utils/interpolationUtils';\nimport './canvas.scss';\n\nconst handleGroupDragMove = (e, canvasWidth, canvasHeight) => {\n\tif (e.target.getClassName() !== 'Group') return;\n\tconst group = e.target;\n\tconst topLeft = group.get('.topLeft')[0];\n\tconst rect = group.get('Rect')[0];\n\tlet absX; let absY;\n\t// boundary\n\tabsX = topLeft.getAbsolutePosition().x;\n\tabsY = topLeft.getAbsolutePosition().y;\n\tabsX = absX < 0 ? 0 : absX;\n\tabsY = absY < 0 ? 0 : absY;\n\tabsX = absX + rect.width() > canvasWidth ? canvasWidth - rect.width() : absX;\n\tabsY = absY + rect.height() > canvasHeight ? canvasHeight - rect.height() : absY;\n\ttopLeft.setAbsolutePosition({ x: absX, y: absY });\n\tgroup.x(topLeft.getAbsolutePosition().x);\n\tgroup.y(topLeft.getAbsolutePosition().y);\n\ttopLeft.position({ x: 0, y: 0 });\n};\n\nconst Canvas = ({\n\tclassName,\n\tdotLength,\n\twidth: canvasWidth,\n\theight: canvasHeight,\n\tobjects,\n\tplayed,\n\tfocusing,\n\tisAdding,\n\tentities,\n\tannotations,\n\tisEmptyCheckEnable,\n\tonStageMouseDown,\n\tonGroupDragEnd,\n\tonGroupMouseDown,\n\tonDotDragEnd,\n\tonDotMouseDown,\n}) => {\n\tconst { t } = useTranslation('twoDimensionalVideo');\n\tconst layerItems = [];\n\tannotations.slice().reverse().forEach((annotationId) => {\n\t\tconst {\n\t\t\tincidents, color, id, name, label, isManipulatable,\n\t\t} = entities.annotations[annotationId];\n\n\t\tfor (let i = 0; i < incidents.length; i++) {\n\t\t\tlet x;\n\t\t\tlet y;\n\t\t\tlet width;\n\t\t\tlet height;\n\n\t\t\tif (played >= incidents[i].time) {\n\t\t\t\tif (i !== incidents.length - 1 && played >= incidents[i + 1].time) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (incidents[i].status !== SHOW) break; // todo\n\n\t\t\t\tif (i === incidents.length - 1) {\n\t\t\t\t\t({\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty,\n\t\t\t\t\t\twidth,\n\t\t\t\t\t\theight,\n\t\t\t\t\t} = incidents[i]);\n\t\t\t\t} else {\n\t\t\t\t\tconst interpoArea = getInterpolatedData({\n\t\t\t\t\t\tstartIncident: incidents[i],\n\t\t\t\t\t\tendIncident: incidents[i + 1],\n\t\t\t\t\t\tcurrentTime: played,\n\t\t\t\t\t\ttype: INTERPOLATION_TYPE.LENGTH,\n\t\t\t\t\t});\n\t\t\t\t\tconst interpoPos = getInterpolatedData({\n\t\t\t\t\t\tstartIncident: incidents[i],\n\t\t\t\t\t\tendIncident: incidents[i + 1],\n\t\t\t\t\t\tcurrentTime: played,\n\t\t\t\t\t\ttype: INTERPOLATION_TYPE.POSITION,\n\t\t\t\t\t});\n\t\t\t\t\t({\n\t\t\t\t\t\tx, y,\n\t\t\t\t\t} = interpoPos);\n\t\t\t\t\t({\n\t\t\t\t\t\twidth, height,\n\t\t\t\t\t} = interpoArea);\n\t\t\t\t}\n\n\t\t\t\tconst fill = (focusing === name) ? color.replace(/,1\\)/, ',.3)') : '';\n\t\t\t\tconst rect = (\n\t\t\t\t\t<Rect\n\t\t\t\t\t\tx={ 0 }\n\t\t\t\t\t\ty={ 0 }\n\t\t\t\t\t\tfill={ fill }\n\t\t\t\t\t\twidth={ width }\n\t\t\t\t\t\theight={ height }\n\t\t\t\t\t\tstroke={ color }\n\t\t\t\t\t\tstrokeWidth={ 1 }\n\t\t\t\t\t\tonFocus={ () => {} }\n\t\t\t\t\t\tonMouseOver={ () => {\n\t\t\t\t\t\t\tif (!isManipulatable || isAdding) return;\n\t\t\t\t\t\t\tdocument.body.style.cursor = 'pointer';\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t\tconst labelText = (\n\t\t\t\t\t<Text\n\t\t\t\t\t\toffsetY={ 20 }\n\t\t\t\t\t\tx={ 0 }\n\t\t\t\t\t\ty={ 0 }\n\t\t\t\t\t\tfontFamily='Arial'\n\t\t\t\t\t\ttext={ label }\n\t\t\t\t\t\tfontSize={ 16 }\n\t\t\t\t\t\tlineHeight={ 1.2 }\n\t\t\t\t\t\tfill='#fff'\n\t\t\t\t\t/>\n\t\t\t\t);\n\n\t\t\t\tlet resizingAnchorsUI = null;\n\t\t\t\tconst resizingAnchorsData = [\n\t\t\t\t\t{ x: 0, y: 0, key: 'topLeft', name: 'topLeft' },\n\t\t\t\t\t{ x: width, y: 0, key: 'topRight', name: 'topRight' },\n\t\t\t\t\t{ x: width, y: height, key: 'bottomRight', name: 'bottomRight' },\n\t\t\t\t\t{ x: 0, y: height, key: 'bottomLeft', name: 'bottomLeft' },\n\t\t\t\t\t{ x: width / 2, y: 0, key: 'top', name: 'top' },\n\t\t\t\t\t{ x: 0, y: height / 2, key: 'left', name: 'left' },\n\t\t\t\t\t{ x: width, y: height / 2, key: 'right', name: 'right' },\n\t\t\t\t\t{ x: width / 2, y: height, key: 'bottom', name: 'bottom' },\n\t\t\t\t];\n\t\t\t\tif (isManipulatable) {\n\t\t\t\t\tresizingAnchorsUI = resizingAnchorsData.map(data => (\n\t\t\t\t\t\t<ResizingAnchor\n\t\t\t\t\t\t\tdotLength={ dotLength }\n\t\t\t\t\t\t\tcolor={ color }\n\t\t\t\t\t\t\tisManipulatable={ isManipulatable }\n\t\t\t\t\t\t\tx={ data.x }\n\t\t\t\t\t\t\ty={ data.y }\n\t\t\t\t\t\t\tkey={ data.key }\n\t\t\t\t\t\t\tname={ data.name }\n\t\t\t\t\t\t\tcanvasWidth={ canvasWidth }\n\t\t\t\t\t\t\tcanvasHeight={ canvasHeight }\n\t\t\t\t\t\t\tonDragEnd={ onDotDragEnd }\n\t\t\t\t\t\t\tonMouseDown={ onDotMouseDown }\n\t\t\t\t\t\t/>\n\t\t\t\t\t));\n\t\t\t\t}\n\t\t\t\tlayerItems.push(\n\t\t\t\t\t<Group\n\t\t\t\t\t\tx={ x }\n\t\t\t\t\t\ty={ y }\n\t\t\t\t\t\tkey={ name }\n\t\t\t\t\t\tid={ id }\n\t\t\t\t\t\tname={ name }\n\t\t\t\t\t\tdraggable={ isManipulatable }\n\t\t\t\t\t\tonMouseDown={ (e) => {\n\t\t\t\t\t\t\tconst group = e.target.findAncestor('Group');\n\t\t\t\t\t\t\tif (!isManipulatable) return;\n\t\t\t\t\t\t\tgroup.moveToTop();\n\t\t\t\t\t\t\tonGroupMouseDown(e);\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tonDragEnd={ (e) => {\n\t\t\t\t\t\t\tif (e.target.getClassName() !== 'Group') return;\n\t\t\t\t\t\t\tonGroupDragEnd(e);\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tonDragMove={ e => handleGroupDragMove(e, canvasWidth, canvasHeight) }\n\t\t\t\t\t>\n\t\t\t\t\t\t{labelText}\n\t\t\t\t\t\t{rect}\n\t\t\t\t\t\t{resizingAnchorsUI}\n\t\t\t\t\t</Group>,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t});\n\treturn (\n\t\t<Stage\n\t\t\twidth={ canvasWidth }\n\t\t\theight={ canvasHeight }\n\t\t\tclassName='konva-wrapper'\n\t\t\tonMouseDown={ e => onStageMouseDown(e) }\n\t\t\tonMouseOver={ () => { if (isAdding) { document.body.style.cursor = 'crosshair'; } } }\n\t\t\tonMouseLeave={ () => { document.body.style.cursor = 'default'; } }\n\t\t\tonMouseOut={ () => { document.body.style.cursor = 'default'; } }\n\t\t\tonBlur={ () => {} }\n\t\t\tonFocus={ () => {} }\n\t\t>\n\t\t\t{ isAdding && (\n\t\t\t\t<Layer>\n\t\t\t\t\t<Rect fill='#ffffff' width={ canvasWidth } height={ canvasHeight } opacity={ 0.3 } />\n\t\t\t\t\t<Text y={ canvasHeight / 2 } width={ canvasWidth } text={ t('canvasAddingHint') } align='center' fontSize={ 16 } fill='#fff' />\n\t\t\t\t</Layer>\n\t\t\t)}\n\t\t\t<Layer>{layerItems}</Layer>\n\t\t</Stage>\n\t);\n};\n\nCanvas.propTypes = {\n\tclassName: PropTypes.string,\n\tdotLength: PropTypes.number,\n};\nCanvas.defaultProps = {\n\tclassName: '',\n\tdotLength: 6,\n};\nexport default Canvas;\n"]},"metadata":{},"sourceType":"module"}