{"ast":null,"code":"var _jsxFileName = \"/Applications/CrowdMOT/crowdmot-nextjs/components/two-dimensional-video/components/TwoDimensionalVideo/TwoDimensionalVideo.jsx\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { I18nextProvider, Translation } from 'react-i18next';\nimport { normalize, denormalize, schema } from 'normalizr';\nimport { Button, ButtonGroup } from 'reactstrap';\nimport { MdRedo, MdUndo, MdAdd } from 'react-icons/md';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport PopupDialog from 'shared/components/PopupDialog/PopupDialog.jsx';\nimport { highContrastingColors as colors } from 'shared/utils/colorUtils';\nimport { getRandomInt, getFixedNumber } from 'shared/utils/mathUtils';\nimport { UndoRedo } from '/Applications/CrowdMOT/crowdmot-nextjs/components/models/UndoRedo.js';\nimport i18nextInstance from './i18n';\nimport { Rectangle } from '../../models/rectangle';\nimport { Incident, SPLIT, HIDE, SHOW } from '../../models/incident';\nimport TwoDimensionalVideoContext from './twoDimensionalVideoContext';\nimport { getInterpolatedData, INTERPOLATION_TYPE } from '../../utils/interpolationUtils';\nimport Preview from '../Preview/Preview.jsx';\nimport Review from '../Review/Review.jsx';\nimport AnnotationList from '../AnnotationList/AnnotationList.jsx';\nimport DrawableVideoPlayer from '../DrawableVideoPlayer/DrawableVideoPlayer.jsx';\nimport { getLastAnnotationLabel, getUniqueKey } from '../../utils/utils';\nimport './twoDimensionalVideo.scss';\n\nvar randomColor = require('randomcolor');\n\nclass TwoDimensionalVideo extends Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"buttonStyles\", {\n      marginLeft: 5\n    });\n\n    _defineProperty(this, \"handlePlayerRef\", player => {\n      this.player = player;\n    });\n\n    _defineProperty(this, \"handleVideoReady\", () => {\n      this.setState({\n        annotationHeight: document.getElementById('react-player').children[0].clientHeight\n      });\n    });\n\n    _defineProperty(this, \"handleVideoProgress\", state => {\n      const {\n        played\n      } = state;\n      this.setState(prevState => {\n        if (prevState.isSeeking) return null;\n        return {\n          played: getFixedNumber(played, 5)\n        };\n      });\n    });\n\n    _defineProperty(this, \"handleVideoDuration\", duration => {\n      this.setState({\n        duration\n      });\n    });\n\n    _defineProperty(this, \"handleVideoEnded\", () => {\n      this.setState(prevState => ({\n        isPlaying: prevState.isLoop\n      }));\n    });\n\n    _defineProperty(this, \"handleVideoRewind\", () => {\n      this.setState({\n        isPlaying: false,\n        played: 0\n      });\n      this.player.seekTo(0);\n    });\n\n    _defineProperty(this, \"handleVideoPlayPause\", () => {\n      this.setState(prevState => ({\n        isPlaying: !prevState.isPlaying\n      }));\n    });\n\n    _defineProperty(this, \"handleVideoSpeedChange\", s => {\n      this.setState({\n        playbackRate: s\n      });\n    });\n\n    _defineProperty(this, \"handleVideoSliderMouseUp\", () => {\n      this.setState({\n        isSeeking: false\n      });\n    });\n\n    _defineProperty(this, \"handleVideoSliderMouseDown\", () => {\n      this.setState({\n        isPlaying: false,\n        isSeeking: true\n      });\n    });\n\n    _defineProperty(this, \"handleVideoSliderChange\", e => {\n      const played = getFixedNumber(e.target.value, 5);\n      this.setState(prevState => {\n        const {\n          entities\n        } = prevState;\n        let {\n          focusing\n        } = prevState;\n\n        if (focusing) {\n          const {\n            incidents\n          } = entities.annotations[focusing];\n\n          for (let i = 0; i < incidents.length; i += 1) {\n            if (played >= incidents[i].time) {\n              if (i !== incidents.length - 1 && played >= incidents[i + 1].time) continue;\n              if (incidents[i].status !== SHOW) focusing = '';\n              break;\n            } else if (i === incidents.length - 1) focusing = '';\n          }\n        }\n\n        return {\n          played,\n          focusing\n        };\n      }, () => {\n        this.player.seekTo(played);\n      });\n    });\n\n    _defineProperty(this, \"handleCanvasStageMouseDown\", e => {\n      const {\n        isAdding\n      } = this.state;\n      if (!isAdding) return;\n      const stage = e.target.getStage();\n      const position = stage.getPointerPosition();\n      const uniqueKey = getUniqueKey();\n      const color = colors[getRandomInt(colors.length)]; // const color = randomColor({\n      // \tluminosity: 'light',\n      // \tformat: 'rgba' // e.g. 'rgba(9, 1, 107, 0.6482447960879654)'\n      // });\n\n      this.setState(prevState => {\n        this.UndoRedoState.save(_objectSpread(_objectSpread({}, prevState), {}, {\n          isAdding: false\n        })); // Undo/Redo\n\n        const {\n          annotations,\n          entities\n        } = prevState;\n        const incidents = [];\n        incidents.push(Incident({\n          id: `${uniqueKey}`,\n          name: `${uniqueKey}`,\n          x: position.x,\n          y: position.y,\n          height: 1,\n          width: 1,\n          time: prevState.played\n        }));\n        entities.annotations[`${uniqueKey}`] = Rectangle({\n          id: `${uniqueKey}`,\n          name: `${uniqueKey}`,\n          label: `${getLastAnnotationLabel(annotations, entities) + 1}`,\n          color,\n          incidents\n        });\n        return {\n          isAdding: false,\n          focusing: `${uniqueKey}`,\n          annotations: [...annotations, `${uniqueKey}`],\n          entities: _objectSpread(_objectSpread({}, entities), {}, {\n            annotations: entities.annotations\n          })\n        };\n      }, () => {\n        const group = stage.find(`.${uniqueKey}`)[0];\n        const bottomRight = group.get('.bottomRight')[0];\n        group.moveToTop();\n        bottomRight.moveToTop();\n        bottomRight.startDrag();\n      });\n    });\n\n    _defineProperty(this, \"handleCanvasGroupMouseDown\", e => {\n      const group = e.target.findAncestor('Group');\n      this.setState({\n        isPlaying: false,\n        focusing: group.name()\n      });\n    });\n\n    _defineProperty(this, \"handleCanvasGroupDragEnd\", e => {\n      if (e.target.getClassName() !== 'Group') return;\n      const group = e.target;\n      const rect = group.get('Rect')[0];\n      const position = group.position();\n      const uniqueKey = getUniqueKey();\n      this.setState(prevState => {\n        this.UndoRedoState.save(prevState);\n        const {\n          entities,\n          played\n        } = prevState;\n        const {\n          incidents\n        } = entities.annotations[group.name()];\n\n        for (let i = 0; i < incidents.length; i += 1) {\n          if (played >= incidents[i].time) {\n            // skip elapsed incidents\n            if (i !== incidents.length - 1 && played >= incidents[i + 1].time) continue;\n\n            if (played === incidents[i].time) {\n              incidents[i].x = position.x;\n              incidents[i].y = position.y;\n              incidents[i].width = rect.width();\n              incidents[i].height = rect.height();\n              break;\n            }\n\n            if (i === incidents.length - 1) {\n              incidents.push(Incident({\n                id: `${uniqueKey}`,\n                name: `${uniqueKey}`,\n                x: position.x,\n                y: position.y,\n                width: rect.width(),\n                height: rect.height(),\n                time: played\n              }));\n              break;\n            }\n\n            incidents.splice(i + 1, 0, Incident({\n              id: `${uniqueKey}`,\n              name: `${uniqueKey}`,\n              x: position.x,\n              y: position.y,\n              height: rect.height(),\n              width: rect.width(),\n              time: played\n            }));\n            break;\n          }\n        }\n\n        return {};\n      });\n    });\n\n    _defineProperty(this, \"handleCanvasDotMouseDown\", e => {\n      const group = e.target.findAncestor('Group');\n      this.setState({\n        focusing: group.name()\n      });\n    });\n\n    _defineProperty(this, \"handleCanvasDotDragEnd\", e => {\n      const activeAnchor = e.target;\n      const group = activeAnchor.getParent();\n      const uniqueKey = getUniqueKey();\n      group.draggable(true);\n      const topLeft = group.get('.topLeft')[0];\n      const topRight = group.get('.topRight')[0];\n      const bottomRight = group.get('.bottomRight')[0];\n      const bottomLeft = group.get('.bottomLeft')[0];\n      const maxX = Math.max(topLeft.getAbsolutePosition().x, topRight.getAbsolutePosition().x, bottomRight.getAbsolutePosition().x, bottomLeft.getAbsolutePosition().x);\n      const minX = Math.min(topLeft.getAbsolutePosition().x, topRight.getAbsolutePosition().x, bottomRight.getAbsolutePosition().x, bottomLeft.getAbsolutePosition().x);\n      const maxY = Math.max(topLeft.getAbsolutePosition().y, topRight.getAbsolutePosition().y, bottomRight.getAbsolutePosition().y, bottomLeft.getAbsolutePosition().y);\n      const minY = Math.min(topLeft.getAbsolutePosition().y, topRight.getAbsolutePosition().y, bottomRight.getAbsolutePosition().y, bottomLeft.getAbsolutePosition().y);\n      this.setState((prevState, props) => {\n        this.UndoRedoState.save(prevState);\n        const {\n          entities,\n          played\n        } = prevState;\n        const {\n          annotations\n        } = entities;\n        const {\n          incidents\n        } = entities.annotations[group.name()];\n\n        for (let i = 0; i < incidents.length; i += 1) {\n          if (played >= incidents[i].time) {\n            // skip elapsed incidents\n            if (i !== incidents.length - 1 && played >= incidents[i + 1].time) continue;\n\n            if (played === incidents[i].time) {\n              incidents[i].x = minX;\n              incidents[i].y = minY;\n              incidents[i].height = maxY - minY;\n              incidents[i].width = maxX - minX;\n              break;\n            }\n\n            incidents.splice(i + 1, 0, Incident({\n              id: `${uniqueKey}`,\n              name: `${uniqueKey}`,\n              x: minX,\n              y: minY,\n              height: maxY - minY,\n              width: maxX - minX,\n              time: played\n            }));\n            break;\n          }\n        }\n\n        annotations[group.name()].incidents = incidents;\n        return {\n          entities: _objectSpread(_objectSpread({}, entities), {}, {\n            annotations\n          })\n        };\n      });\n    });\n\n    _defineProperty(this, \"handleAnnotationItemClick\", name => this.setState({\n      focusing: name\n    }));\n\n    _defineProperty(this, \"handleIncidentItemClick\", incident => {\n      const {\n        annotationName,\n        time\n      } = incident;\n      this.setState({\n        isPlaying: false,\n        focusing: annotationName\n      }, () => {\n        this.player.seekTo(parseFloat(time));\n      });\n    });\n\n    _defineProperty(this, \"handleIncidentItemDelete\", e => {\n      const {\n        annotationName,\n        incidentName\n      } = e;\n      this.setState(prevState => {\n        this.UndoRedoState.save(prevState);\n        const {\n          entities\n        } = prevState;\n        const {\n          annotations\n        } = entities;\n        const incidents = entities.annotations[annotationName].incidents.filter(t => {\n          if (t.name !== incidentName) return true;\n          return false;\n        });\n        annotations[annotationName].incidents = incidents;\n        return {\n          entities: _objectSpread(_objectSpread({}, entities), {}, {\n            annotations\n          })\n        };\n      });\n    });\n\n    _defineProperty(this, \"handleListAnnotationDelete\", name => {\n      this.setState(prevState => {\n        this.UndoRedoState.save(prevState);\n        const {\n          entities,\n          annotations\n        } = prevState;\n        const entitiesAnnotations = entities.annotations;\n        const {\n          label\n        } = entitiesAnnotations[name]; // reorder the list\n\n        if (!isNaN(label)) {\n          const lastLabel = getLastAnnotationLabel(annotations, entities);\n\n          if (`${lastLabel}` !== '1' && `${lastLabel}` !== label) {\n            const lastName = annotations.find(a => entitiesAnnotations[a].label === `${lastLabel}`);\n            this.renameLabel(annotations, entitiesAnnotations, lastName, label);\n          }\n        } // remove name from the parent's childrenNames\n\n\n        if (entitiesAnnotations[name].parentName) {\n          const parent = entitiesAnnotations[entitiesAnnotations[name].parentName];\n          const i = parent.childrenNames.indexOf(name);\n\n          if (i !== -1) {\n            parent.childrenNames.splice(i, 1);\n            if (parent.childrenNames.length == 0 && parent.incidents[parent.incidents.length - 1].status === SPLIT) parent.incidents[parent.incidents.length - 1].status = SHOW;\n          }\n        } // remove all its children and itself recusively\n\n\n        this.removeAnnotation(annotations, entitiesAnnotations, name);\n        return {\n          annotations,\n          entities: _objectSpread(_objectSpread({}, entities), {}, {\n            annotations: entitiesAnnotations\n          }),\n          focusing: ''\n        };\n      });\n    });\n\n    _defineProperty(this, \"removeAnnotation\", (annotations, entitiesAnnotations, name) => {\n      if (entitiesAnnotations[name].childrenNames.length !== 0) {\n        entitiesAnnotations[name].childrenNames.forEach(c => {\n          this.removeAnnotation(annotations, entitiesAnnotations, c);\n        });\n      }\n\n      delete entitiesAnnotations.name;\n      const i = annotations.indexOf(name);\n      annotations.splice(i, 1);\n    });\n\n    _defineProperty(this, \"renameLabel\", (annotations, entitiesAnnotations, name, label) => {\n      if (entitiesAnnotations[name].childrenNames.length !== 0) {\n        entitiesAnnotations[name].childrenNames.forEach((c, index) => {\n          this.renameLabel(annotations, entitiesAnnotations, c, `${label}-${index + 1}`);\n        });\n      }\n\n      entitiesAnnotations[name].label = label;\n    });\n\n    _defineProperty(this, \"handleListAnnotationShowHide\", e => {\n      console.log(e);\n      const {\n        name\n      } = e;\n      const {\n        status\n      } = e;\n      const uniqueKey = new Date().getTime().toString(36);\n      this.setState(prevState => {\n        this.UndoRedoState.save(prevState);\n        const {\n          played,\n          entities\n        } = prevState;\n        const {\n          incidents\n        } = entities.annotations[name];\n\n        for (let i = 0; i < incidents.length; i += 1) {\n          if (i === 0 && played < incidents[i].time) {\n            incidents.splice(0, 0, Incident({\n              id: `${uniqueKey}`,\n              name: `${uniqueKey}`,\n              x: incidents[i].x,\n              y: incidents[i].y,\n              height: incidents[i].height,\n              width: incidents[i].width,\n              time: played,\n              status\n            }));\n            break;\n          }\n\n          if (played >= incidents[i].time) {\n            // skip elapsed incidents\n            if (i !== incidents.length - 1 && played >= incidents[i + 1].time) continue;\n\n            if (played === incidents[i].time) {\n              incidents.splice(i, 1, Incident(_objectSpread(_objectSpread({}, incidents[i]), {}, {\n                id: `${uniqueKey}`,\n                name: `${uniqueKey}`,\n                status\n              })));\n              break;\n            }\n\n            if (i === incidents.length - 1) {\n              incidents.push(Incident({\n                id: `${uniqueKey}`,\n                name: `${uniqueKey}`,\n                x: incidents[i].x,\n                y: incidents[i].y,\n                height: incidents[i].height,\n                width: incidents[i].width,\n                time: played,\n                status\n              }));\n              break;\n            }\n\n            const interpoArea = getInterpolatedData({\n              startIncident: incidents[i],\n              endIncident: incidents[i + 1],\n              currentTime: played,\n              type: INTERPOLATION_TYPE.LENGTH\n            });\n            const interpoPos = getInterpolatedData({\n              startIncident: incidents[i],\n              endIncident: incidents[i + 1],\n              currentTime: played,\n              type: INTERPOLATION_TYPE.POSITION\n            });\n            incidents.splice(i + 1, 0, Incident({\n              id: `${uniqueKey}`,\n              name: `${uniqueKey}`,\n              x: interpoPos.x,\n              y: interpoPos.y,\n              height: interpoArea.height,\n              width: interpoArea.width,\n              time: played,\n              status\n            }));\n            break;\n          }\n        }\n\n        if (status === HIDE) entities.annotations[name].clearRedundantIncidents(status);\n        return {\n          entities: _objectSpread(_objectSpread({}, entities), {}, {\n            annotations: entities.annotations\n          })\n        };\n      });\n    });\n\n    _defineProperty(this, \"handleListAnnotationSplit\", name => {\n      const timeNow = new Date().getTime().toString(36);\n      const timeNowChild1 = (new Date().getTime() + 1).toString(36);\n      const timeNowChild2 = (new Date().getTime() + 2).toString(36);\n      const status = SPLIT;\n      this.setState(prevState => {\n        this.UndoRedoState.save(prevState);\n        const {\n          played,\n          entities,\n          annotations\n        } = prevState;\n        const parent = entities.annotations[name]; // remove ex-childrenNames\n\n        if (parent.childrenNames.length !== 0) {\n          for (const c of parent.childrenNames) {\n            delete entities.annotations[c];\n            const i = annotations.indexOf(c);\n            annotations.splice(i, 1);\n          }\n        } // make sure parent's color is different from its children\n\n\n        let randomColor = colors[getRandomInt(colors.length)];\n\n        while (parent.color === randomColor) randomColor = colors[getRandomInt(colors.length)];\n\n        const childrenColor = randomColor; // const childrenColor = randomColor({\n        // \tluminosity: 'light',\n        // \tformat: 'rgba' // e.g. 'rgba(9, 1, 107, 0.6482447960879654)'\n        // });\n\n        let parentX;\n        let parentY;\n        let parentWidth;\n        let parentHeight;\n        let {\n          incidents\n        } = parent;\n\n        for (let i = 0; i < incidents.length; i++) {\n          if (played >= incidents[i].time) {\n            if (i !== incidents.length - 1 && played >= incidents[i + 1].time) continue;\n            parentX = incidents[i].x;\n            parentY = incidents[i].y;\n            parentWidth = incidents[i].width;\n            parentHeight = incidents[i].height;\n\n            if (played === incidents[i].time) {\n              incidents.splice(i, 1, Incident(_objectSpread(_objectSpread({}, incidents[i]), {}, {\n                id: `${timeNow}`,\n                name: `${timeNow}`,\n                status\n              })));\n              incidents = incidents.slice(0, i + 1);\n              break;\n            }\n\n            if (i === incidents.length - 1) {\n              incidents.push(Incident({\n                id: `${timeNow}`,\n                name: `${timeNow}`,\n                x: incidents[i].x,\n                y: incidents[i].y,\n                height: incidents[i].height,\n                width: incidents[i].width,\n                time: played,\n                status\n              }));\n              break;\n            }\n\n            const interpoArea = getInterpolatedData({\n              startIncident: incidents[i],\n              endIncident: incidents[i + 1],\n              currentTime: played,\n              type: INTERPOLATION_TYPE.LENGTH\n            });\n            const interpoPos = getInterpolatedData({\n              startIncident: incidents[i],\n              endIncident: incidents[i + 1],\n              currentTime: played,\n              type: INTERPOLATION_TYPE.POSITION\n            });\n            parentX = interpoPos.x;\n            parentY = interpoPos.y;\n            parentWidth = interpoArea.width;\n            parentHeight = interpoArea.height;\n            incidents.splice(i + 1, 0, Incident({\n              id: `${timeNow}`,\n              name: `${timeNow}`,\n              x: interpoPos.x,\n              y: interpoPos.y,\n              height: interpoArea.height,\n              width: interpoArea.width,\n              time: played,\n              status\n            }));\n            incidents = incidents.slice(0, i + 2);\n            break;\n          }\n        }\n\n        parent.childrenNames = [`${timeNowChild1}`, `${timeNowChild2}`];\n        parent.incidents = incidents;\n        const childIncidents1 = [Incident({\n          id: `${timeNow}`,\n          name: `${timeNow}`,\n          x: parentX,\n          y: parentY,\n          height: parentHeight / 2,\n          width: parentWidth / 2,\n          time: played\n        })];\n        const childIncidents2 = [Incident({\n          id: `${timeNow}`,\n          name: `${timeNow}`,\n          x: parentX + parentWidth / 2 - 20,\n          y: parentY + parentHeight / 2 - 20,\n          height: parentHeight / 2,\n          width: parentWidth / 2,\n          time: played\n        })];\n        entities.annotations[`${timeNowChild1}`] = Rectangle({\n          id: `${timeNowChild1}`,\n          name: `${timeNowChild1}`,\n          label: `${parent.label}-1`,\n          color: childrenColor,\n          incidents: childIncidents1,\n          parentName: parent.name\n        });\n        entities.annotations[`${timeNowChild2}`] = Rectangle({\n          id: `${timeNowChild2}`,\n          name: `${timeNowChild2}`,\n          label: `${parent.label}-2`,\n          color: childrenColor,\n          incidents: childIncidents2,\n          parentName: parent.name\n        });\n        const parentIndex = annotations.find(a => a === parent.name);\n        annotations.splice(parentIndex, 0, `${timeNowChild1}`);\n        annotations.splice(parentIndex, 0, `${timeNowChild2}`);\n        return {\n          annotations,\n          entities,\n          focusing: `${timeNowChild2}`\n        };\n      });\n    });\n\n    _defineProperty(this, \"handleUndo\", () => {\n      if (this.UndoRedoState.previous.length === 0) return;\n      this.setState(prevState => {\n        const state = this.UndoRedoState.undo(prevState);\n        return _objectSpread({}, state);\n      });\n    });\n\n    _defineProperty(this, \"handleRedo\", () => {\n      if (this.UndoRedoState.next.length === 0) return;\n      this.setState(prevState => {\n        const state = this.UndoRedoState.redo(prevState);\n        return _objectSpread({}, state);\n      });\n    });\n\n    _defineProperty(this, \"handlePreviewClick\", () => this.setState({\n      isPreviewed: true\n    }));\n\n    _defineProperty(this, \"handleReviewCancelSubmission\", () => this.setState({\n      isLoop: false,\n      isSubmitted: false,\n      isPlaying: false\n    }));\n\n    _defineProperty(this, \"isEmptyAnnotationOrIncident\", () => {\n      const {\n        annotations,\n        defaultNumAnnotations,\n        entities\n      } = this.state;\n      const {\n        isEmptyCheckEnable\n      } = this.props;\n      if (!isEmptyCheckEnable) return false;\n\n      if (annotations.length !== 0 && defaultNumAnnotations < annotations.length) {\n        for (const ann of annotations) {\n          if (entities.annotations[ann].incidents.length < 2) return true;\n        }\n\n        return false;\n      }\n\n      return true;\n    });\n\n    _defineProperty(this, \"handleSubmit\", () => {\n      const {\n        annotations,\n        isSubmitted\n      } = this.state;\n      const {\n        onSubmit,\n        hasReview,\n        emptyCheckSubmissionWarningText\n      } = this.props;\n\n      if (this.isEmptyAnnotationOrIncident()) {\n        this.setState({\n          isDialogOpen: true,\n          dialogTitle: 'Submission warning',\n          dialogMessage: emptyCheckSubmissionWarningText\n        });\n        return;\n      }\n\n      if (!isSubmitted && hasReview) {\n        this.setState({\n          isLoop: true,\n          isSubmitted: true,\n          played: 0,\n          isPlaying: true,\n          focusing: ''\n        });\n        return;\n      }\n\n      const {\n        videoWidth,\n        annotationHeight,\n        entities,\n        duration\n      } = this.state;\n      const {\n        url\n      } = this.props;\n      const annotation = new schema.Entity('annotations');\n      const denormalizedAnnotations = denormalize({\n        annotations\n      }, {\n        annotations: [annotation]\n      }, entities).annotations;\n      denormalizedAnnotations.forEach(ann => {\n        delete ann.isManipulatable;\n      });\n      const data = {\n        url,\n        videoWidth,\n        annotationHeight,\n        annotations: denormalizedAnnotations,\n        duration\n      };\n      onSubmit(data);\n    });\n\n    _defineProperty(this, \"handleDialogToggle\", () => this.setState(prevState => ({\n      isDialogOpen: !prevState.isDialogOpen\n    })));\n\n    _defineProperty(this, \"handleAddClick\", () => this.setState(prevState => ({\n      isAdding: !prevState.isAdding,\n      isPlaying: false\n    })));\n\n    _defineProperty(this, \"handleShowCurrent\", e => {\n      console.log(this.state);\n      let annot_length = this.state.annotations.length; // console.log(this.state.annotations[annot_length-1]);\n\n      for (var j = 0; j < annot_length - 1; j++) {\n        let not_curr_box = this.state.annotations[j];\n        let not_curr_box_name = this.state.entities.annotations[not_curr_box];\n\n        for (var i = 0; i < not_curr_box_name.incidents.length; i++) {\n          not_curr_box_name.incidents[i].status = \"Hide\";\n          not_curr_box_name.incidents[i].displayCurrent = false;\n        }\n      } // let curr_box = this.state.annotations[annot_length-1]\n      // console.log(this.state.entities.annotations[curr_box]);\n      // let curr_box_name = this.state.entities.annotations[curr_box];\n      // for (var i=0; i< curr_box_name.incidents.length; i++){\n      // \tcurr_box_name.incidents[i].status = \"Hide\"; \n      // }\n      // console.log(curr_box_name.incidents)\n\n    });\n\n    _defineProperty(this, \"renderAddButtonUI\", () => {\n      const {\n        isAdding,\n        defaultNumRootAnnotations,\n        annotations,\n        entities\n      } = this.state;\n      const {\n        numAnnotationsCanBeAdded\n      } = this.props;\n      const isAddButtonAvailable = defaultNumRootAnnotations + numAnnotationsCanBeAdded > getLastAnnotationLabel(annotations, entities);\n\n      if (isAdding || !isAdding && isAddButtonAvailable) {\n        return __jsx(Button, {\n          disabled: isAdding,\n          color: \"primary\",\n          onClick: this.handleAddClick,\n          className: \"d-flex align-items-center float-left\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 587,\n            columnNumber: 6\n          }\n        }, __jsx(MdAdd, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 593,\n            columnNumber: 7\n          }\n        }), __jsx(Translation, {\n          ns: \"twoDimensionalVideo\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 594,\n            columnNumber: 7\n          }\n        }, t => isAdding ? t('addingBox') : t('addBox')));\n      }\n\n      return null;\n    });\n\n    const {\n      defaultAnnotations,\n      videoWidth: _videoWidth,\n      previewHeader,\n      previewNoticeList,\n      duration: _duration\n    } = props;\n    console.log(props);\n    console.log(\"Hello props\\n\" + JSON.stringify(props));\n    /* ===  normalize annotation props === */\n\n    const _entities = {\n      annotations: {}\n    };\n    let _annotations = [];\n\n    if (defaultAnnotations && defaultAnnotations.length !== 0) {\n      const annotation = new schema.Entity('annotations');\n      const normalizedAnn = normalize(defaultAnnotations, [annotation]);\n      _entities.annotations = normalizedAnn.entities.annotations;\n      _annotations = normalizedAnn.result;\n\n      _annotations.forEach(id => {\n        _entities.annotations[id].isManipulatable = props.isDefaultAnnotationsManipulatable;\n      });\n    }\n\n    this.state = {\n      isPreviewed: previewNoticeList && previewNoticeList.length === 0 && !previewHeader,\n      isSubmitted: false,\n      videoWidth: _videoWidth,\n      annotationHeight: 200,\n      entities: _entities,\n      annotations: _annotations,\n      played: 0,\n      isPlaying: false,\n      playbackRate: 1,\n      duration: 0,\n      isLoop: false,\n      isSeeking: false,\n      isAdding: false,\n      focusing: '',\n      isDialogOpen: false,\n      dialogTitle: '',\n      dialogMessage: '',\n      defaultNumAnnotations: _annotations.length,\n      defaultNumRootAnnotations: getLastAnnotationLabel(_annotations, _entities)\n    };\n    this.UndoRedoState = new UndoRedo();\n  }\n  /* ==================== video player ==================== */\n\n\n  render() {\n    const {\n      isPreviewed,\n      isSubmitted,\n      videoWidth,\n      annotationHeight,\n      isPlaying,\n      played,\n      playbackRate,\n      duration,\n      isLoop,\n      isAdding,\n      focusing,\n      entities,\n      annotations,\n      isDialogOpen,\n      dialogTitle,\n      dialogMessage\n    } = this.state;\n    const {\n      className,\n      url,\n      previewHeader,\n      previewNoticeList,\n      isEmptyCheckEnable,\n      isSplitEnable,\n      isShowHideEnable,\n      emptyCheckAnnotationItemWarningText,\n      emptyAnnotationReminderText\n    } = this.props;\n    const twoDimensionalVideoContext = {\n      playerRef: this.handlePlayerRef,\n      entities,\n      annotations,\n      duration,\n      played,\n      focusing,\n      width: videoWidth,\n      height: annotationHeight,\n      isEmptyCheckEnable,\n      url,\n      isPlaying,\n      isLoop,\n      playbackRate,\n      isAdding,\n      isSplitEnable,\n      isShowHideEnable,\n      emptyCheckAnnotationItemWarningText,\n      emptyAnnotationReminderText,\n      onVideoReady: this.handleVideoReady,\n      onVideoProgress: this.handleVideoProgress,\n      onVideoDuration: this.handleVideoDuration,\n      onVideoEnded: this.handleVideoEnded,\n      onVideoSliderMouseUp: this.handleVideoSliderMouseUp,\n      onVideoSliderMouseDown: this.handleVideoSliderMouseDown,\n      onVideoSliderChange: this.handleVideoSliderChange,\n      onVideoRewind: this.handleVideoRewind,\n      onVideoPlayPause: this.handleVideoPlayPause,\n      onVideoSpeedChange: this.handleVideoSpeedChange,\n      onCanvasStageMouseDown: this.handleCanvasStageMouseDown,\n      onCanvasGroupMouseDown: this.handleCanvasGroupMouseDown,\n      onCanvasGroupDragEnd: this.handleCanvasGroupDragEnd,\n      onCanvasDotMouseDown: this.handleCanvasDotMouseDown,\n      onCanvasDotDragEnd: this.handleCanvasDotDragEnd,\n      onAnnotationItemClick: this.handleAnnotationItemClick,\n      onAnnotationDeleteClick: this.handleListAnnotationDelete,\n      onAnnotationShowHideClick: this.handleListAnnotationShowHide,\n      onAnnotationSplitClick: this.handleListAnnotationSplit,\n      onIncidentItemClick: this.handleIncidentItemClick,\n      onIncidentItemDeleteClick: this.handleIncidentItemDelete\n    };\n    let controlPanelUI = null;\n\n    if (isSubmitted) {\n      controlPanelUI = __jsx(Review, {\n        height: annotationHeight,\n        onConfirmSubmit: this.handleSubmit,\n        onCancelSubmit: this.handleReviewCancelSubmission,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 680,\n          columnNumber: 6\n        }\n      });\n    } else if (isPreviewed) {\n      controlPanelUI = __jsx(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 688,\n          columnNumber: 6\n        }\n      }, __jsx(\"div\", {\n        className: \"pb-3 clearfix\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 689,\n          columnNumber: 7\n        }\n      }, this.renderAddButtonUI(), __jsx(Button, {\n        color: \"primary\",\n        style: this.buttonStyles,\n        onClick: this.handleShowCurrent,\n        className: \"d-flex align-items-center float-left\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 691,\n          columnNumber: 8\n        }\n      }, \"Hide Other Boxes\"), __jsx(ButtonGroup, {\n        className: \"float-right\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 697,\n          columnNumber: 8\n        }\n      }, __jsx(Button, {\n        disabled: this.UndoRedoState.previous.length === 0,\n        outline: true,\n        onClick: this.handleUndo,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 698,\n          columnNumber: 9\n        }\n      }, __jsx(MdUndo, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 698,\n          columnNumber: 103\n        }\n      })), __jsx(Button, {\n        disabled: this.UndoRedoState.next.length === 0,\n        outline: true,\n        onClick: this.handleRedo,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 699,\n          columnNumber: 9\n        }\n      }, __jsx(MdRedo, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 699,\n          columnNumber: 99\n        }\n      })))), __jsx(AnnotationList, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 704,\n          columnNumber: 7\n        }\n      }));\n    } else {\n      controlPanelUI = __jsx(Preview, {\n        height: annotationHeight,\n        notices: previewNoticeList,\n        header: previewHeader,\n        onPreviewClick: this.handlePreviewClick,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 709,\n          columnNumber: 6\n        }\n      });\n    }\n\n    const rootClassName = `two-dimensional-video${className ? ` ${className}` : ''}`;\n    return __jsx(I18nextProvider, {\n      i18n: i18nextInstance,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 721,\n        columnNumber: 5\n      }\n    }, __jsx(TwoDimensionalVideoContext.Provider, {\n      value: twoDimensionalVideoContext,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 722,\n        columnNumber: 6\n      }\n    }, __jsx(\"div\", {\n      className: rootClassName,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 723,\n        columnNumber: 7\n      }\n    }, __jsx(\"div\", {\n      className: \"d-flex flex-wrap justify-content-around py-3 two-dimensional-video__main\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 724,\n        columnNumber: 8\n      }\n    }, __jsx(\"div\", {\n      className: \"mb-3\",\n      style: {\n        width: videoWidth\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 725,\n        columnNumber: 9\n      }\n    }, __jsx(DrawableVideoPlayer, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 726,\n        columnNumber: 10\n      }\n    })), __jsx(\"div\", {\n      className: \"mb-3 two-dimensional-video__control-panel\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 728,\n        columnNumber: 9\n      }\n    }, controlPanelUI)), __jsx(\"div\", {\n      className: \"d-flex justify-content-center pt-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 732,\n        columnNumber: 8\n      }\n    }, isSubmitted || !isPreviewed ? '' : __jsx(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 733,\n        columnNumber: 46\n      }\n    }, __jsx(Button, {\n      onClick: this.handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 733,\n        columnNumber: 51\n      }\n    }, \"Submit\"))), __jsx(PopupDialog, {\n      isOpen: isDialogOpen,\n      title: dialogTitle,\n      message: dialogMessage,\n      onToggle: this.handleDialogToggle,\n      hasCloseButton: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 735,\n        columnNumber: 8\n      }\n    }))));\n  }\n\n}\n\nTwoDimensionalVideo.propTypes = {\n  className: PropTypes.string,\n  defaultAnnotations: PropTypes.arrayOf(PropTypes.object),\n  videoWidth: PropTypes.number,\n  isDefaultAnnotationsManipulatable: PropTypes.bool,\n  previewHeader: PropTypes.string,\n  previewNoticeList: PropTypes.arrayOf(PropTypes.string),\n  isEmptyCheckEnable: PropTypes.bool,\n  isSplitEnable: PropTypes.bool,\n  isShowHideEnable: PropTypes.bool,\n  hasReview: PropTypes.bool,\n  url: PropTypes.string,\n  numAnnotationsCanBeAdded: PropTypes.number,\n  onSubmit: PropTypes.func,\n  emptyCheckSubmissionWarningText: PropTypes.string,\n  emptyCheckAnnotationItemWarningText: PropTypes.string,\n  emptyAnnotationReminderText: PropTypes.string\n};\nTwoDimensionalVideo.defaultProps = {\n  className: '',\n  defaultAnnotations: [],\n  videoWidth: 400,\n  isDefaultAnnotationsManipulatable: false,\n  previewHeader: '',\n  previewNoticeList: [],\n  isEmptyCheckEnable: false,\n  isSplitEnable: false,\n  isShowHideEnable: false,\n  hasReview: false,\n  url: '',\n  numAnnotationsCanBeAdded: 1000,\n  onSubmit: () => {},\n  emptyCheckSubmissionWarningText: '',\n  emptyCheckAnnotationItemWarningText: '',\n  emptyAnnotationReminderText: ''\n};\nexport default TwoDimensionalVideo;","map":{"version":3,"sources":["/Applications/CrowdMOT/crowdmot-nextjs/components/two-dimensional-video/components/TwoDimensionalVideo/TwoDimensionalVideo.jsx"],"names":["React","Component","PropTypes","I18nextProvider","Translation","normalize","denormalize","schema","Button","ButtonGroup","MdRedo","MdUndo","MdAdd","PopupDialog","highContrastingColors","colors","getRandomInt","getFixedNumber","UndoRedo","i18nextInstance","Rectangle","Incident","SPLIT","HIDE","SHOW","TwoDimensionalVideoContext","getInterpolatedData","INTERPOLATION_TYPE","Preview","Review","AnnotationList","DrawableVideoPlayer","getLastAnnotationLabel","getUniqueKey","randomColor","require","TwoDimensionalVideo","constructor","props","marginLeft","player","setState","annotationHeight","document","getElementById","children","clientHeight","state","played","prevState","isSeeking","duration","isPlaying","isLoop","seekTo","s","playbackRate","e","target","value","entities","focusing","incidents","annotations","i","length","time","status","isAdding","stage","getStage","position","getPointerPosition","uniqueKey","color","UndoRedoState","save","push","id","name","x","y","height","width","label","group","find","bottomRight","get","moveToTop","startDrag","findAncestor","getClassName","rect","splice","activeAnchor","getParent","draggable","topLeft","topRight","bottomLeft","maxX","Math","max","getAbsolutePosition","minX","min","maxY","minY","incident","annotationName","parseFloat","incidentName","filter","t","entitiesAnnotations","isNaN","lastLabel","lastName","a","renameLabel","parentName","parent","childrenNames","indexOf","removeAnnotation","forEach","c","index","console","log","Date","getTime","toString","interpoArea","startIncident","endIncident","currentTime","type","LENGTH","interpoPos","POSITION","clearRedundantIncidents","timeNow","timeNowChild1","timeNowChild2","childrenColor","parentX","parentY","parentWidth","parentHeight","slice","childIncidents1","childIncidents2","parentIndex","previous","undo","next","redo","isPreviewed","isSubmitted","defaultNumAnnotations","isEmptyCheckEnable","ann","onSubmit","hasReview","emptyCheckSubmissionWarningText","isEmptyAnnotationOrIncident","isDialogOpen","dialogTitle","dialogMessage","videoWidth","url","annotation","Entity","denormalizedAnnotations","isManipulatable","data","annot_length","j","not_curr_box","not_curr_box_name","displayCurrent","defaultNumRootAnnotations","numAnnotationsCanBeAdded","isAddButtonAvailable","handleAddClick","defaultAnnotations","previewHeader","previewNoticeList","JSON","stringify","normalizedAnn","result","isDefaultAnnotationsManipulatable","render","className","isSplitEnable","isShowHideEnable","emptyCheckAnnotationItemWarningText","emptyAnnotationReminderText","twoDimensionalVideoContext","playerRef","handlePlayerRef","onVideoReady","handleVideoReady","onVideoProgress","handleVideoProgress","onVideoDuration","handleVideoDuration","onVideoEnded","handleVideoEnded","onVideoSliderMouseUp","handleVideoSliderMouseUp","onVideoSliderMouseDown","handleVideoSliderMouseDown","onVideoSliderChange","handleVideoSliderChange","onVideoRewind","handleVideoRewind","onVideoPlayPause","handleVideoPlayPause","onVideoSpeedChange","handleVideoSpeedChange","onCanvasStageMouseDown","handleCanvasStageMouseDown","onCanvasGroupMouseDown","handleCanvasGroupMouseDown","onCanvasGroupDragEnd","handleCanvasGroupDragEnd","onCanvasDotMouseDown","handleCanvasDotMouseDown","onCanvasDotDragEnd","handleCanvasDotDragEnd","onAnnotationItemClick","handleAnnotationItemClick","onAnnotationDeleteClick","handleListAnnotationDelete","onAnnotationShowHideClick","handleListAnnotationShowHide","onAnnotationSplitClick","handleListAnnotationSplit","onIncidentItemClick","handleIncidentItemClick","onIncidentItemDeleteClick","handleIncidentItemDelete","controlPanelUI","handleSubmit","handleReviewCancelSubmission","renderAddButtonUI","buttonStyles","handleShowCurrent","handleUndo","handleRedo","handlePreviewClick","rootClassName","handleDialogToggle","propTypes","string","arrayOf","object","number","bool","func","defaultProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { I18nextProvider, Translation } from 'react-i18next';\nimport { normalize, denormalize, schema } from 'normalizr';\nimport { Button, ButtonGroup } from 'reactstrap';\nimport { MdRedo, MdUndo, MdAdd } from 'react-icons/md';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport PopupDialog from 'shared/components/PopupDialog/PopupDialog.jsx';\nimport { highContrastingColors as colors } from 'shared/utils/colorUtils';\nimport { getRandomInt, getFixedNumber } from 'shared/utils/mathUtils';\nimport { UndoRedo } from '/Applications/CrowdMOT/crowdmot-nextjs/components/models/UndoRedo.js';\nimport i18nextInstance from './i18n';\nimport { Rectangle } from '../../models/rectangle';\nimport { Incident, SPLIT, HIDE, SHOW } from '../../models/incident';\nimport TwoDimensionalVideoContext from './twoDimensionalVideoContext';\nimport { getInterpolatedData, INTERPOLATION_TYPE } from '../../utils/interpolationUtils';\nimport Preview from '../Preview/Preview.jsx';\nimport Review from '../Review/Review.jsx';\nimport AnnotationList from '../AnnotationList/AnnotationList.jsx';\nimport DrawableVideoPlayer from '../DrawableVideoPlayer/DrawableVideoPlayer.jsx';\nimport { getLastAnnotationLabel, getUniqueKey } from '../../utils/utils';\nimport './twoDimensionalVideo.scss';\nvar randomColor = require('randomcolor');\n\nclass TwoDimensionalVideo extends Component {\n\tbuttonStyles = {\n\t\tmarginLeft: 5\n\t}\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tconst {\n\t\t\tdefaultAnnotations,\n\t\t\tvideoWidth,\n\t\t\tpreviewHeader,\n\t\t\tpreviewNoticeList,\n\t\t\tduration,\n\t\t} = props;\n\t\tconsole.log(props)\n\t\tconsole.log(\"Hello props\\n\"+JSON.stringify(props))\n\t\t\t\t/* ===  normalize annotation props === */\n\t\tconst entities = { annotations: {} };\n\t\tlet annotations = [];\n\t\tif (defaultAnnotations && defaultAnnotations.length !== 0) {\n\t\t\tconst annotation = new schema.Entity('annotations');\n\t\t\tconst normalizedAnn = normalize(defaultAnnotations, [annotation]);\n\t\t\tentities.annotations = normalizedAnn.entities.annotations;\n\t\t\tannotations = normalizedAnn.result;\n\t\t\tannotations.forEach((id) => {\n\t\t\t\tentities.annotations[id].isManipulatable = props.isDefaultAnnotationsManipulatable;\n\t\t\t});\n\t\t}\n\t\tthis.state = {\n\t\t\tisPreviewed: previewNoticeList && previewNoticeList.length === 0 && !previewHeader,\n\t\t\tisSubmitted: false,\n\t\t\tvideoWidth,\n\t\t\tannotationHeight: 200,\n\t\t\tentities,\n\t\t\tannotations,\n\t\t\tplayed: 0,\n\t\t\tisPlaying: false,\n\t\t\tplaybackRate: 1,\n\t\t\tduration: 0,\n\t\t\tisLoop: false,\n\t\t\tisSeeking: false,\n\t\t\tisAdding: false,\n\t\t\tfocusing: '',\n\t\t\tisDialogOpen: false,\n\t\t\tdialogTitle: '',\n\t\t\tdialogMessage: '',\n\t\t\tdefaultNumAnnotations: annotations.length,\n\t\t\tdefaultNumRootAnnotations: getLastAnnotationLabel(annotations, entities),\n\t\t};\n\t\tthis.UndoRedoState = new UndoRedo();\n\t}\n\n\t/* ==================== video player ==================== */\n\thandlePlayerRef = (player) => {\n\t\tthis.player = player;\n\t}\n\n\thandleVideoReady = () => {\n\t\tthis.setState({ annotationHeight: document.getElementById('react-player').children[0].clientHeight });\n\t}\n\n\thandleVideoProgress = (state) => {\n\t\tconst { played } = state;\n\t\tthis.setState((prevState) => {\n\t\t\tif (prevState.isSeeking) return null;\n\t\t\treturn { played: getFixedNumber(played, 5) };\n\t\t});\n\t}\n\n\thandleVideoDuration = (duration) => {\n\t\tthis.setState({ duration });\n\t}\n\n\thandleVideoEnded = () => {\n\t\tthis.setState(prevState => ({ isPlaying: prevState.isLoop }));\n\t}\n\n\thandleVideoRewind = () => {\n\t\tthis.setState({ isPlaying: false, played: 0 });\n\t\tthis.player.seekTo(0);\n\t}\n\n\thandleVideoPlayPause = () => {\n\t\tthis.setState(prevState => ({ isPlaying: !prevState.isPlaying }));\n\t}\n\n\thandleVideoSpeedChange = (s) => {\n\t\tthis.setState({ playbackRate: s });\n\t}\n\n\thandleVideoSliderMouseUp = () => {\n\t\tthis.setState({ isSeeking: false });\n\t}\n\n\thandleVideoSliderMouseDown = () => {\n\t\tthis.setState({ isPlaying: false, isSeeking: true });\n\t}\n\n\thandleVideoSliderChange = (e) => {\n\t\tconst played = getFixedNumber(e.target.value, 5);\n\t\tthis.setState((prevState) => {\n\t\t\tconst { entities } = prevState;\n\t\t\tlet { focusing } = prevState;\n\t\t\tif (focusing) {\n\t\t\t\tconst { incidents } = entities.annotations[focusing];\n\t\t\t\tfor (let i = 0; i < incidents.length; i += 1) {\n\t\t\t\t\tif (played >= incidents[i].time) {\n\t\t\t\t\t\tif (i !== incidents.length - 1 && played >= incidents[i + 1].time) continue;\n\t\t\t\t\t\tif (incidents[i].status !== SHOW) focusing = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else if (i === incidents.length - 1) focusing = '';\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn { played, focusing };\n\t\t}, () => { this.player.seekTo(played); });\n\t}\n\n\t/* ==================== canvas ==================== */\n\n\thandleCanvasStageMouseDown = (e) => {\n\t\tconst { isAdding } = this.state;\n\t\tif (!isAdding) return;\n\t\tconst stage = e.target.getStage();\n\t\tconst position = stage.getPointerPosition();\n\t\tconst uniqueKey = getUniqueKey();\n\t\tconst color = colors[getRandomInt(colors.length)];\n\t\t// const color = randomColor({\n\n\t\t// \tluminosity: 'light',\n\t\t// \tformat: 'rgba' // e.g. 'rgba(9, 1, 107, 0.6482447960879654)'\n\t\t// });\n\t\tthis.setState((prevState) => {\n\t\t\tthis.UndoRedoState.save({ ...prevState, isAdding: false }); // Undo/Redo\n\t\t\tconst {\n\t\t\t\tannotations, entities,\n\t\t\t} = prevState;\n\t\t\tconst incidents = [];\n\t\t\tincidents.push(Incident({\n\t\t\t\tid: `${uniqueKey}`, name: `${uniqueKey}`, x: position.x, y: position.y, height: 1, width: 1, time: prevState.played,\n\t\t\t}));\n\t\t\tentities.annotations[`${uniqueKey}`] = Rectangle({\n\t\t\t\tid: `${uniqueKey}`, name: `${uniqueKey}`, label: `${getLastAnnotationLabel(annotations, entities) + 1}`, color, incidents,\n\t\t\t});\n\t\t\treturn {\n\t\t\t\tisAdding: false,\n\t\t\t\tfocusing: `${uniqueKey}`,\n\t\t\t\tannotations: [...annotations, `${uniqueKey}`],\n\t\t\t\tentities: { ...entities, annotations: entities.annotations },\n\t\t\t};\n\t\t}, () => {\n\t\t\tconst group = stage.find(`.${uniqueKey}`)[0];\n\t\t\tconst bottomRight = group.get('.bottomRight')[0];\n\t\t\tgroup.moveToTop();\n\t\t\tbottomRight.moveToTop();\n\t\t\tbottomRight.startDrag();\n\t\t});\n\t}\n\n\thandleCanvasGroupMouseDown = (e) => {\n\t\tconst group = e.target.findAncestor('Group');\n\t\tthis.setState({ isPlaying: false, focusing: group.name() });\n\t}\n\n\thandleCanvasGroupDragEnd = (e) => {\n\t\tif (e.target.getClassName() !== 'Group') return;\n\t\tconst group = e.target;\n\t\tconst rect = group.get('Rect')[0];\n\t\tconst position = group.position();\n\t\tconst uniqueKey = getUniqueKey();\n\t\tthis.setState((prevState) => {\n\t\t\tthis.UndoRedoState.save(prevState);\n\t\t\tconst { entities, played } = prevState;\n\t\t\tconst { incidents } = entities.annotations[group.name()];\n\t\t\tfor (let i = 0; i < incidents.length; i += 1) {\n\t\t\t\tif (played >= incidents[i].time) {\n\t\t\t\t\t// skip elapsed incidents\n\t\t\t\t\tif (i !== incidents.length - 1 && played >= incidents[i + 1].time) continue;\n\t\t\t\t\tif (played === incidents[i].time) {\n\t\t\t\t\t\tincidents[i].x = position.x; incidents[i].y = position.y; incidents[i].width = rect.width(); incidents[i].height = rect.height();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tif (i === incidents.length - 1) {\n\t\t\t\t\t\tincidents.push(Incident({\n\t\t\t\t\t\t\tid: `${uniqueKey}`, name: `${uniqueKey}`, x: position.x, y: position.y, width: rect.width(), height: rect.height(), time: played,\n\t\t\t\t\t\t}));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tincidents.splice(i + 1, 0, Incident({\n\t\t\t\t\t\tid: `${uniqueKey}`, name: `${uniqueKey}`, x: position.x, y: position.y, height: rect.height(), width: rect.width(), time: played,\n\t\t\t\t\t}));\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {};\n\t\t});\n\t}\n\n\thandleCanvasDotMouseDown = (e) => {\n\t\tconst group = e.target.findAncestor('Group');\n\t\tthis.setState({ focusing: group.name() });\n\t}\n\n\thandleCanvasDotDragEnd = (e) => {\n\t\tconst activeAnchor = e.target;\n\t\tconst group = activeAnchor.getParent();\n\t\tconst uniqueKey = getUniqueKey();\n\t\tgroup.draggable(true);\n\t\tconst topLeft = group.get('.topLeft')[0]; const topRight = group.get('.topRight')[0]; const bottomRight = group.get('.bottomRight')[0]; const\n\t\t\tbottomLeft = group.get('.bottomLeft')[0];\n\t\tconst maxX = Math.max(topLeft.getAbsolutePosition().x, topRight.getAbsolutePosition().x, bottomRight.getAbsolutePosition().x, bottomLeft.getAbsolutePosition().x);\n\t\tconst minX = Math.min(topLeft.getAbsolutePosition().x, topRight.getAbsolutePosition().x, bottomRight.getAbsolutePosition().x, bottomLeft.getAbsolutePosition().x);\n\t\tconst maxY = Math.max(topLeft.getAbsolutePosition().y, topRight.getAbsolutePosition().y, bottomRight.getAbsolutePosition().y, bottomLeft.getAbsolutePosition().y);\n\t\tconst minY = Math.min(topLeft.getAbsolutePosition().y, topRight.getAbsolutePosition().y, bottomRight.getAbsolutePosition().y, bottomLeft.getAbsolutePosition().y);\n\t\tthis.setState((prevState, props) => {\n\t\t\tthis.UndoRedoState.save(prevState);\n\t\t\tconst { entities, played } = prevState;\n\t\t\tconst { annotations } = entities;\n\t\t\tconst { incidents } = entities.annotations[group.name()];\n\t\t\tfor (let i = 0; i < incidents.length; i += 1) {\n\t\t\t\tif (played >= incidents[i].time) {\n\t\t\t\t\t// skip elapsed incidents\n\t\t\t\t\tif (i !== incidents.length - 1 && played >= incidents[i + 1].time) continue;\n\t\t\t\t\tif (played === incidents[i].time) {\n\t\t\t\t\t\tincidents[i].x = minX; incidents[i].y = minY; incidents[i].height = maxY - minY; incidents[i].width = maxX - minX;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tincidents.splice(i + 1, 0, Incident({\n\t\t\t\t\t\tid: `${uniqueKey}`, name: `${uniqueKey}`, x: minX, y: minY, height: maxY - minY, width: maxX - minX, time: played,\n\t\t\t\t\t}));\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tannotations[group.name()].incidents = incidents;\n\t\t\treturn { entities: { ...entities, annotations } };\n\t\t});\n\t}\n\n\thandleAnnotationItemClick = name => this.setState({ focusing: name });\n\n\thandleIncidentItemClick = (incident) => {\n\t\tconst { annotationName, time } = incident;\n\t\tthis.setState({ isPlaying: false, focusing: annotationName },\n\t\t\t() => { this.player.seekTo(parseFloat(time)); });\n\t}\n\n\thandleIncidentItemDelete = (e) => {\n\t\tconst { annotationName, incidentName } = e;\n\t\tthis.setState((prevState) => {\n\t\t\tthis.UndoRedoState.save(prevState);\n\t\t\tconst { entities } = prevState;\n\t\t\tconst { annotations } = entities;\n\t\t\tconst incidents = entities.annotations[annotationName].incidents.filter((t) => {\n\t\t\t\tif (t.name !== incidentName) return true;\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\tannotations[annotationName].incidents = incidents;\n\t\t\treturn { entities: { ...entities, annotations } };\n\t\t});\n\t}\n\n\n\thandleListAnnotationDelete = (name) => {\n\t\tthis.setState((prevState) => {\n\t\t\tthis.UndoRedoState.save(prevState);\n\t\t\tconst { entities, annotations } = prevState;\n\t\t\tconst entitiesAnnotations = entities.annotations;\n\t\t\tconst { label } = entitiesAnnotations[name];\n\t\t\t// reorder the list\n\t\t\tif (!isNaN(label)) {\n\t\t\t\tconst lastLabel = getLastAnnotationLabel(annotations, entities);\n\t\t\t\tif (`${lastLabel}` !== '1' && `${lastLabel}` !== label) {\n\t\t\t\t\tconst lastName = annotations.find(a => entitiesAnnotations[a].label === `${lastLabel}`);\n\t\t\t\t\tthis.renameLabel(annotations, entitiesAnnotations, lastName, label);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// remove name from the parent's childrenNames\n\t\t\tif (entitiesAnnotations[name].parentName) {\n\t\t\t\tconst parent = entitiesAnnotations[entitiesAnnotations[name].parentName];\n\t\t\t\tconst i = parent.childrenNames.indexOf(name);\n\t\t\t\tif (i !== -1) {\n\t\t\t\t\tparent.childrenNames.splice(i, 1);\n\t\t\t\t\tif (parent.childrenNames.length == 0 && parent.incidents[parent.incidents.length - 1].status === SPLIT) parent.incidents[parent.incidents.length - 1].status = SHOW;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// remove all its children and itself recusively\n\t\t\tthis.removeAnnotation(annotations, entitiesAnnotations, name);\n\t\t\treturn { annotations, entities: { ...entities, annotations: entitiesAnnotations }, focusing: '' };\n\t\t});\n\t}\n\n\tremoveAnnotation = (annotations, entitiesAnnotations, name) => {\n\t\tif (entitiesAnnotations[name].childrenNames.length !== 0) {\n\t\t\tentitiesAnnotations[name].childrenNames.forEach((c) => {\n\t\t\t\tthis.removeAnnotation(annotations, entitiesAnnotations, c);\n\t\t\t});\n\t\t}\n\t\tdelete entitiesAnnotations.name;\n\t\tconst i = annotations.indexOf(name);\n\t\tannotations.splice(i, 1);\n\t}\n\n\trenameLabel = (annotations, entitiesAnnotations, name, label) => {\n\t\tif (entitiesAnnotations[name].childrenNames.length !== 0) {\n\t\t\tentitiesAnnotations[name].childrenNames.forEach((c, index) => {\n\t\t\t\tthis.renameLabel(annotations, entitiesAnnotations, c, `${label}-${index + 1}`);\n\t\t\t});\n\t\t}\n\t\tentitiesAnnotations[name].label = label;\n\t}\n\n\thandleListAnnotationShowHide = (e) => {\n\t\tconsole.log(e);\n\t\tconst { name } = e;\n\t\tconst { status } = e;\n\t\tconst uniqueKey = new Date().getTime().toString(36);\n\t\tthis.setState((prevState) => {\n\t\t\tthis.UndoRedoState.save(prevState);\n\t\t\tconst { played, entities } = prevState;\n\t\t\tconst { incidents } = entities.annotations[name];\n\t\t\tfor (let i = 0; i < incidents.length; i += 1) {\n\t\t\t\tif (i === 0 && played < incidents[i].time) {\n\t\t\t\t\tincidents.splice(0, 0, Incident({\n\t\t\t\t\t\tid: `${uniqueKey}`, name: `${uniqueKey}`, x: incidents[i].x, y: incidents[i].y, height: incidents[i].height, width: incidents[i].width, time: played, status,\n\t\t\t\t\t}));\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (played >= incidents[i].time) {\n\t\t\t\t\t// skip elapsed incidents\n\t\t\t\t\tif (i !== incidents.length - 1 && played >= incidents[i + 1].time) continue;\n\t\t\t\t\tif (played === incidents[i].time) {\n\t\t\t\t\t\tincidents.splice(i, 1, Incident({\n\t\t\t\t\t\t\t...incidents[i], id: `${uniqueKey}`, name: `${uniqueKey}`, status,\n\t\t\t\t\t\t}));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tif (i === incidents.length - 1) {\n\t\t\t\t\t\tincidents.push(Incident({\n\t\t\t\t\t\t\tid: `${uniqueKey}`, name: `${uniqueKey}`, x: incidents[i].x, y: incidents[i].y, height: incidents[i].height, width: incidents[i].width, time: played, status,\n\t\t\t\t\t\t}));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tconst interpoArea = getInterpolatedData({\n\t\t\t\t\t\tstartIncident: incidents[i],\n\t\t\t\t\t\tendIncident: incidents[i + 1],\n\t\t\t\t\t\tcurrentTime: played,\n\t\t\t\t\t\ttype: INTERPOLATION_TYPE.LENGTH,\n\t\t\t\t\t});\n\t\t\t\t\tconst interpoPos = getInterpolatedData({\n\t\t\t\t\t\tstartIncident: incidents[i],\n\t\t\t\t\t\tendIncident: incidents[i + 1],\n\t\t\t\t\t\tcurrentTime: played,\n\t\t\t\t\t\ttype: INTERPOLATION_TYPE.POSITION,\n\t\t\t\t\t});\n\t\t\t\t\tincidents.splice(i + 1, 0, Incident({\n\t\t\t\t\t\tid: `${uniqueKey}`, name: `${uniqueKey}`, x: interpoPos.x, y: interpoPos.y, height: interpoArea.height, width: interpoArea.width, time: played, status,\n\t\t\t\t\t}));\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (status === HIDE) entities.annotations[name].clearRedundantIncidents(status);\n\t\t\treturn { entities: { ...entities, annotations: entities.annotations } };\n\t\t});\n\t}\n\n\n\thandleListAnnotationSplit = (name) => {\n\t\tconst timeNow = (new Date()).getTime().toString(36);\n\t\tconst timeNowChild1 = ((new Date()).getTime() + 1).toString(36);\n\t\tconst timeNowChild2 = ((new Date()).getTime() + 2).toString(36);\n\t\tconst status = SPLIT;\n\t\tthis.setState((prevState) => {\n\t\t\tthis.UndoRedoState.save(prevState);\n\t\t\tconst { played, entities, annotations } = prevState;\n\t\t\tconst parent = entities.annotations[name];\n\t\t\t// remove ex-childrenNames\n\t\t\tif (parent.childrenNames.length !== 0) {\n\t\t\t\tfor (const c of parent.childrenNames) {\n\t\t\t\t\tdelete entities.annotations[c];\n\t\t\t\t\tconst i = annotations.indexOf(c);\n\t\t\t\t\tannotations.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// make sure parent's color is different from its children\n\t\t\tlet randomColor = colors[getRandomInt(colors.length)];\n\t\t\twhile (parent.color === randomColor) randomColor = colors[getRandomInt(colors.length)];\n\t\t\tconst childrenColor = randomColor;\n\t\t\t// const childrenColor = randomColor({\n\n\t\t\t// \tluminosity: 'light',\n\t\t\t// \tformat: 'rgba' // e.g. 'rgba(9, 1, 107, 0.6482447960879654)'\n\t\t\t// });\n\n\t\t\tlet parentX; let parentY; let parentWidth; let\n\t\t\t\tparentHeight;\n\t\t\tlet { incidents } = parent;\n\t\t\tfor (let i = 0; i < incidents.length; i++) {\n\t\t\t\tif (played >= incidents[i].time) {\n\t\t\t\t\tif (i !== incidents.length - 1 && played >= incidents[i + 1].time) continue;\n\t\t\t\t\tparentX = incidents[i].x;\n\t\t\t\t\tparentY = incidents[i].y;\n\t\t\t\t\tparentWidth = incidents[i].width;\n\t\t\t\t\tparentHeight = incidents[i].height;\n\t\t\t\t\tif (played === incidents[i].time) {\n\t\t\t\t\t\tincidents.splice(i, 1, Incident({\n\t\t\t\t\t\t\t...incidents[i], id: `${timeNow}`, name: `${timeNow}`, status,\n\t\t\t\t\t\t}));\n\t\t\t\t\t\tincidents = incidents.slice(0, i + 1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tif (i === incidents.length - 1) {\n\t\t\t\t\t\tincidents.push(Incident({\n\t\t\t\t\t\t\tid: `${timeNow}`, name: `${timeNow}`, x: incidents[i].x, y: incidents[i].y, height: incidents[i].height, width: incidents[i].width, time: played, status,\n\t\t\t\t\t\t}));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tconst interpoArea = getInterpolatedData({\n\t\t\t\t\t\tstartIncident: incidents[i],\n\t\t\t\t\t\tendIncident: incidents[i + 1],\n\t\t\t\t\t\tcurrentTime: played,\n\t\t\t\t\t\ttype: INTERPOLATION_TYPE.LENGTH,\n\t\t\t\t\t});\n\t\t\t\t\tconst interpoPos = getInterpolatedData({\n\t\t\t\t\t\tstartIncident: incidents[i],\n\t\t\t\t\t\tendIncident: incidents[i + 1],\n\t\t\t\t\t\tcurrentTime: played,\n\t\t\t\t\t\ttype: INTERPOLATION_TYPE.POSITION,\n\t\t\t\t\t});\n\t\t\t\t\tparentX = interpoPos.x;\n\t\t\t\t\tparentY = interpoPos.y;\n\t\t\t\t\tparentWidth = interpoArea.width;\n\t\t\t\t\tparentHeight = interpoArea.height;\n\t\t\t\t\tincidents.splice(i + 1, 0, Incident({\n\t\t\t\t\t\tid: `${timeNow}`, name: `${timeNow}`, x: interpoPos.x, y: interpoPos.y, height: interpoArea.height, width: interpoArea.width, time: played, status,\n\t\t\t\t\t}));\n\t\t\t\t\tincidents = incidents.slice(0, i + 2);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tparent.childrenNames = [`${timeNowChild1}`, `${timeNowChild2}`];\n\t\t\tparent.incidents = incidents;\n\t\t\tconst childIncidents1 = [Incident({\n\t\t\t\tid: `${timeNow}`, name: `${timeNow}`, x: parentX, y: parentY, height: parentHeight / 2, width: parentWidth / 2, time: played,\n\t\t\t})];\n\t\t\tconst childIncidents2 = [Incident({\n\t\t\t\tid: `${timeNow}`, name: `${timeNow}`, x: parentX + parentWidth / 2 - 20, y: parentY + parentHeight / 2 - 20, height: parentHeight / 2, width: parentWidth / 2, time: played,\n\t\t\t})];\n\t\t\tentities.annotations[`${timeNowChild1}`] = Rectangle({\n\t\t\t\tid: `${timeNowChild1}`, name: `${timeNowChild1}`, label: `${parent.label}-1`, color: childrenColor, incidents: childIncidents1, parentName: parent.name,\n\t\t\t});\n\t\t\tentities.annotations[`${timeNowChild2}`] = Rectangle({\n\t\t\t\tid: `${timeNowChild2}`, name: `${timeNowChild2}`, label: `${parent.label}-2`, color: childrenColor, incidents: childIncidents2, parentName: parent.name,\n\t\t\t});\n\t\t\tconst parentIndex = annotations.find(a => a === parent.name);\n\t\t\tannotations.splice(parentIndex, 0, `${timeNowChild1}`);\n\t\t\tannotations.splice(parentIndex, 0, `${timeNowChild2}`);\n\t\t\treturn { annotations, entities, focusing: `${timeNowChild2}` };\n\t\t});\n\t}\n\n\t/* ==================== undo/redo ==================== */\n\thandleUndo = () => {\n\t\tif (this.UndoRedoState.previous.length === 0) return;\n\t\tthis.setState((prevState) => {\n\t\t\tconst state = this.UndoRedoState.undo(prevState);\n\t\t\treturn { ...state };\n\t\t});\n\t}\n\n\thandleRedo = () => {\n\t\tif (this.UndoRedoState.next.length === 0) return;\n\t\tthis.setState((prevState) => {\n\t\t\tconst state = this.UndoRedoState.redo(prevState);\n\t\t\treturn { ...state };\n\t\t});\n\t}\n\n\t/* ==================== preview ================ */\n\thandlePreviewClick = () => this.setState({ isPreviewed: true });\n\n\t/* ==================== review ==================== */\n\thandleReviewCancelSubmission = () => this.setState({ isLoop: false, isSubmitted: false, isPlaying: false });\n\n\t/* ==================== others ==================== */\n\tisEmptyAnnotationOrIncident = () => {\n\t\tconst { annotations, defaultNumAnnotations, entities } = this.state;\n\t\tconst { isEmptyCheckEnable } = this.props;\n\t\tif (!isEmptyCheckEnable) return false;\n\t\tif (annotations.length !== 0 && defaultNumAnnotations < annotations.length) {\n\t\t\tfor (const ann of annotations) {\n\t\t\t\tif (entities.annotations[ann].incidents.length < 2) return true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\thandleSubmit = () => {\n\t\tconst { annotations, isSubmitted } = this.state;\n\t\tconst { onSubmit, hasReview, emptyCheckSubmissionWarningText } = this.props;\n\n\t\tif (this.isEmptyAnnotationOrIncident()) {\n\t\t\tthis.setState({ isDialogOpen: true, dialogTitle: 'Submission warning', dialogMessage: emptyCheckSubmissionWarningText });\n\t\t\treturn;\n\t\t}\n\t\tif (!isSubmitted && hasReview) {\n\t\t\tthis.setState({\n\t\t\t\tisLoop: true, isSubmitted: true, played: 0, isPlaying: true, focusing: '',\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tconst { videoWidth, annotationHeight, entities, duration } = this.state;\n\t\tconst { url } = this.props;\n\t\tconst annotation = new schema.Entity('annotations');\n\t\tconst denormalizedAnnotations = denormalize({ annotations }, { annotations: [annotation] }, entities).annotations;\n\t\tdenormalizedAnnotations.forEach((ann) => {\n\t\t\tdelete ann.isManipulatable;\n\t\t});\n\t\tconst data = {\n\t\t\turl, videoWidth, annotationHeight, annotations: denormalizedAnnotations, duration\n\t\t};\n\t\tonSubmit(data);\n\t}\n\n\thandleDialogToggle = () => this.setState(prevState => ({ isDialogOpen: !prevState.isDialogOpen }));\n\n\thandleAddClick = () => this.setState(prevState => ({ isAdding: !prevState.isAdding, isPlaying: false }));\n\n\thandleShowCurrent = (e) => {\n\t\tconsole.log(this.state);\n\t\tlet annot_length = this.state.annotations.length;\n\t\t// console.log(this.state.annotations[annot_length-1]);\n\t\tfor (var j = 0; j < annot_length - 1; j++) {\n\t\t\tlet not_curr_box = this.state.annotations[j];\n\t\t\tlet not_curr_box_name = this.state.entities.annotations[not_curr_box];\n\t\t\tfor (var i = 0; i < not_curr_box_name.incidents.length; i++) {\n\t\t\t\t not_curr_box_name.incidents[i].status = \"Hide\";\n\t\t\t\t not_curr_box_name.incidents[i].displayCurrent = false;\n\t\t\t}\n\t\t}\n\t\t\t// let curr_box = this.state.annotations[annot_length-1]\n\t\t\t// console.log(this.state.entities.annotations[curr_box]);\n\t\t\t// let curr_box_name = this.state.entities.annotations[curr_box];\n\n\t\t\t// for (var i=0; i< curr_box_name.incidents.length; i++){\n\t\t\t// \tcurr_box_name.incidents[i].status = \"Hide\"; \n\t\t\t// }\n\t\t\t// console.log(curr_box_name.incidents)\n\n\n\n\t\t}\n\n\t\trenderAddButtonUI = () => {\n\t\t\tconst {\n\t\t\t\tisAdding,\n\t\t\t\tdefaultNumRootAnnotations,\n\t\t\t\tannotations,\n\t\t\t\tentities,\n\t\t\t} = this.state;\n\t\t\tconst { numAnnotationsCanBeAdded } = this.props;\n\t\t\tconst isAddButtonAvailable = (defaultNumRootAnnotations + numAnnotationsCanBeAdded) > getLastAnnotationLabel(annotations, entities);\n\t\t\tif (isAdding || (!isAdding && isAddButtonAvailable)) {\n\t\t\t\treturn (\n\t\t\t\t\t<Button\n\t\t\t\t\t\tdisabled={isAdding}\n\t\t\t\t\t\tcolor='primary'\n\t\t\t\t\t\tonClick={this.handleAddClick}\n\t\t\t\t\t\tclassName='d-flex align-items-center float-left'\n\t\t\t\t\t>\n\t\t\t\t\t\t<MdAdd />\n\t\t\t\t\t\t<Translation ns='twoDimensionalVideo'>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tt => (isAdding ? t('addingBox') : t('addBox'))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</Translation>\n\t\t\t\t\t</Button>\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\trender() {\n\t\t\tconst {\n\t\t\t\tisPreviewed,\n\t\t\t\tisSubmitted,\n\t\t\t\tvideoWidth,\n\t\t\t\tannotationHeight,\n\t\t\t\tisPlaying,\n\t\t\t\tplayed,\n\t\t\t\tplaybackRate,\n\t\t\t\tduration,\n\t\t\t\tisLoop,\n\t\t\t\tisAdding,\n\t\t\t\tfocusing,\n\t\t\t\tentities,\n\t\t\t\tannotations,\n\t\t\t\tisDialogOpen,\n\t\t\t\tdialogTitle,\n\t\t\t\tdialogMessage,\n\t\t\t} = this.state;\n\t\t\tconst {\n\t\t\t\tclassName,\n\t\t\t\turl,\n\t\t\t\tpreviewHeader,\n\t\t\t\tpreviewNoticeList,\n\t\t\t\tisEmptyCheckEnable,\n\t\t\t\tisSplitEnable,\n\t\t\t\tisShowHideEnable,\n\t\t\t\temptyCheckAnnotationItemWarningText,\n\t\t\t\temptyAnnotationReminderText,\n\t\t\t} = this.props;\n\t\t\tconst twoDimensionalVideoContext = {\n\t\t\t\tplayerRef: this.handlePlayerRef,\n\t\t\t\tentities,\n\t\t\t\tannotations,\n\t\t\t\tduration,\n\t\t\t\tplayed,\n\t\t\t\tfocusing,\n\t\t\t\twidth: videoWidth,\n\t\t\t\theight: annotationHeight,\n\t\t\t\tisEmptyCheckEnable,\n\t\t\t\turl,\n\t\t\t\tisPlaying,\n\t\t\t\tisLoop,\n\t\t\t\tplaybackRate,\n\t\t\t\tisAdding,\n\t\t\t\tisSplitEnable,\n\t\t\t\tisShowHideEnable,\n\t\t\t\temptyCheckAnnotationItemWarningText,\n\t\t\t\temptyAnnotationReminderText,\n\t\t\t\tonVideoReady: this.handleVideoReady,\n\t\t\t\tonVideoProgress: this.handleVideoProgress,\n\t\t\t\tonVideoDuration: this.handleVideoDuration,\n\t\t\t\tonVideoEnded: this.handleVideoEnded,\n\t\t\t\tonVideoSliderMouseUp: this.handleVideoSliderMouseUp,\n\t\t\t\tonVideoSliderMouseDown: this.handleVideoSliderMouseDown,\n\t\t\t\tonVideoSliderChange: this.handleVideoSliderChange,\n\t\t\t\tonVideoRewind: this.handleVideoRewind,\n\t\t\t\tonVideoPlayPause: this.handleVideoPlayPause,\n\t\t\t\tonVideoSpeedChange: this.handleVideoSpeedChange,\n\t\t\t\tonCanvasStageMouseDown: this.handleCanvasStageMouseDown,\n\t\t\t\tonCanvasGroupMouseDown: this.handleCanvasGroupMouseDown,\n\t\t\t\tonCanvasGroupDragEnd: this.handleCanvasGroupDragEnd,\n\t\t\t\tonCanvasDotMouseDown: this.handleCanvasDotMouseDown,\n\t\t\t\tonCanvasDotDragEnd: this.handleCanvasDotDragEnd,\n\t\t\t\tonAnnotationItemClick: this.handleAnnotationItemClick,\n\t\t\t\tonAnnotationDeleteClick: this.handleListAnnotationDelete,\n\t\t\t\tonAnnotationShowHideClick: this.handleListAnnotationShowHide,\n\t\t\t\tonAnnotationSplitClick: this.handleListAnnotationSplit,\n\t\t\t\tonIncidentItemClick: this.handleIncidentItemClick,\n\t\t\t\tonIncidentItemDeleteClick: this.handleIncidentItemDelete,\n\t\t\t};\n\n\t\t\tlet controlPanelUI = null;\n\t\t\tif (isSubmitted) {\n\t\t\t\tcontrolPanelUI = (\n\t\t\t\t\t<Review\n\t\t\t\t\t\theight={annotationHeight}\n\t\t\t\t\t\tonConfirmSubmit={this.handleSubmit}\n\t\t\t\t\t\tonCancelSubmit={this.handleReviewCancelSubmission}\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t} else if (isPreviewed) {\n\t\t\t\tcontrolPanelUI = (\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div className='pb-3 clearfix'>\n\t\t\t\t\t\t\t{this.renderAddButtonUI()}\n\t\t\t\t\t\t\t<Button color='primary'\n\t\t\t\t\t\t\t\tstyle={this.buttonStyles}\n\t\t\t\t\t\t\t\tonClick={this.handleShowCurrent}\n\t\t\t\t\t\t\t\tclassName='d-flex align-items-center float-left'>\n\t\t\t\t\t\t\t\tHide Other Boxes\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<ButtonGroup className='float-right'>\n\t\t\t\t\t\t\t\t<Button disabled={this.UndoRedoState.previous.length === 0} outline onClick={this.handleUndo}><MdUndo /></Button>\n\t\t\t\t\t\t\t\t<Button disabled={this.UndoRedoState.next.length === 0} outline onClick={this.handleRedo}><MdRedo /></Button>\n\n\t\t\t\t\t\t\t</ButtonGroup>\n\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<AnnotationList />\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tcontrolPanelUI = (\n\t\t\t\t\t<Preview\n\t\t\t\t\t\theight={annotationHeight}\n\t\t\t\t\t\tnotices={previewNoticeList}\n\t\t\t\t\t\theader={previewHeader}\n\t\t\t\t\t\tonPreviewClick={this.handlePreviewClick}\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst rootClassName = `two-dimensional-video${className ? ` ${className}` : ''}`;\n\t\t\treturn (\n\t\t\t\t\n\t\t\t\t<I18nextProvider i18n={i18nextInstance}>\n\t\t\t\t\t<TwoDimensionalVideoContext.Provider value={twoDimensionalVideoContext}>\n\t\t\t\t\t\t<div className={rootClassName}>\n\t\t\t\t\t\t\t<div className='d-flex flex-wrap justify-content-around py-3 two-dimensional-video__main'>\n\t\t\t\t\t\t\t\t<div className='mb-3' style={{ width: videoWidth }}>\n\t\t\t\t\t\t\t\t\t<DrawableVideoPlayer />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className='mb-3 two-dimensional-video__control-panel'>\n\t\t\t\t\t\t\t\t\t{controlPanelUI}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className='d-flex justify-content-center pt-3'>\n\t\t\t\t\t\t\t\t{isSubmitted || !isPreviewed ? '' : (<div><Button onClick={this.handleSubmit}>Submit</Button></div>)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<PopupDialog isOpen={isDialogOpen} title={dialogTitle} message={dialogMessage} onToggle={this.handleDialogToggle} hasCloseButton />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</TwoDimensionalVideoContext.Provider>\n\t\t\t\t</I18nextProvider>\n\t\t\t);\n\t\t}\n\t}\n\n\tTwoDimensionalVideo.propTypes = {\n\t\tclassName: PropTypes.string,\n\t\tdefaultAnnotations: PropTypes.arrayOf(PropTypes.object),\n\t\tvideoWidth: PropTypes.number,\n\t\tisDefaultAnnotationsManipulatable: PropTypes.bool,\n\t\tpreviewHeader: PropTypes.string,\n\t\tpreviewNoticeList: PropTypes.arrayOf(PropTypes.string),\n\t\tisEmptyCheckEnable: PropTypes.bool,\n\t\tisSplitEnable: PropTypes.bool,\n\t\tisShowHideEnable: PropTypes.bool,\n\t\thasReview: PropTypes.bool,\n\t\turl: PropTypes.string,\n\t\tnumAnnotationsCanBeAdded: PropTypes.number,\n\t\tonSubmit: PropTypes.func,\n\t\temptyCheckSubmissionWarningText: PropTypes.string,\n\t\temptyCheckAnnotationItemWarningText: PropTypes.string,\n\t\temptyAnnotationReminderText: PropTypes.string,\n\t\t\n\t};\n\t\n\tTwoDimensionalVideo.defaultProps = {\n\t\tclassName: '',\n\t\tdefaultAnnotations: [],\n\t\tvideoWidth: 400,\n\t\tisDefaultAnnotationsManipulatable: false,\n\t\tpreviewHeader: '',\n\t\tpreviewNoticeList: [],\n\t\tisEmptyCheckEnable: false,\n\t\tisSplitEnable: false,\n\t\tisShowHideEnable: false,\n\t\thasReview: false,\n\t\turl: '',\n\t\tnumAnnotationsCanBeAdded: 1000,\n\t\tonSubmit: () => { },\n\t\temptyCheckSubmissionWarningText: '',\n\t\temptyCheckAnnotationItemWarningText: '',\n\t\temptyAnnotationReminderText: '',\n\t};\n\texport default TwoDimensionalVideo;\n"]},"metadata":{},"sourceType":"module"}