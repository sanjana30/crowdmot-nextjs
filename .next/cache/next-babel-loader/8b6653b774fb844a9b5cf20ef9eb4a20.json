{"ast":null,"code":"import DatabaseService from \"../../services/database\";\nimport AuthService from \"../../services/auth\";\nimport User from \"../../models/User\";\nexport default (async (req, res) => {\n  if (req.method !== \"POST\") {\n    return res.status(405).end();\n  }\n\n  DatabaseService.connect();\n  const {\n    name,\n    email,\n    password,\n    isSignUp\n  } = req.body;\n  let user = await User.findOne({\n    email\n  });\n\n  if (isSignUp) {\n    if (user) {\n      return res.status(400).end(`An account already exists for email ${email}.`);\n    }\n\n    user = new User({\n      name,\n      email,\n      passwordId: await AuthService.createUser(password)\n    });\n    await user.save();\n  } else {\n    if (!user) {\n      return res.status(400).end(`No account exists for email ${email}`);\n    }\n\n    if (!(await AuthService.validatePassword(user.passwordId, password))) {\n      return res.status(401).end();\n    }\n  }\n\n  res.end(await AuthService.sign({\n    id: user._id\n  }));\n});","map":null,"metadata":{},"sourceType":"module"}